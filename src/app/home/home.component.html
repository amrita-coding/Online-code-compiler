<div class="app">
  <!-- header -->
  <div class="topbar">
    <div class="logo-container">
      <img src="assets/UI%20Design/logo.png" alt="Logo" class="logo-img" />
      <div class="logo-text"><span class="logo-run">Run</span><span class="logo-x">X</span></div>
    </div>

    <div style="color:var(--muted)"> &nbsp;&nbsp; </div>

    <div class="header-right">
      <div class="language-select-wrap">
        <img *ngIf="selectedLangLogo" [src]="selectedLangLogo" alt="Lang Logo" class="lang-logo" />
        <select [(ngModel)]="langId" class="language-select" title="Language selector" (change)="onLangChange()">
          <option *ngFor="let l of languages" [value]="l.id">{{l.name}}</option>
        </select>
      </div>

      <div class="toggle-capsule" title="Theme toggle" (click)="toggleTheme()">
        <span class="capsule-bg">
          <span class="capsule-knob" [class.dark-mode]="isDark">
            {{ isDark ? '☀' : '☾' }}
          </span>
        </span>
        <span class="mode-label">{{ isDark ? 'Light' : 'Dark' }}</span>
      </div>

      <button class="execute" (click)="executeClicked()">Execute ▶</button>
      <div *ngIf="isLoggedIn" class="user-pill">Hi, {{ userName }}</div>
    </div>
  </div>

  <!-- main content -->
  <div class="main">
    <!-- left skinny toolbar -->
    <div class="leftcol">
      <button title="Files" class="icon-btn" [class.active-icon]="activeIcon === 'Files'" (click)="setActiveIcon('Files')">
        <span class="active-line" *ngIf="activeIcon === 'Files'"></span>
        <img src="assets/UI%20Design/document.svg" alt="Files" width="40" height="40" />
      </button>
      <button title="Explorer" class="icon-btn" [class.active-icon]="activeIcon === 'Explorer'" (click)="setActiveIcon('Explorer')">
        <span class="active-line" *ngIf="activeIcon === 'Explorer'"></span>
        <img src="assets/UI%20Design/folder.svg" alt="Explorer" width="40" height="40" />
      </button>
      <button title="Settings" class="icon-btn" [class.active-icon]="activeIcon === 'Settings'" (click)="setActiveIcon('Settings')">
        <span class="active-line" *ngIf="activeIcon === 'Settings'"></span>
        <img src="assets/UI%20Design/settings.svg" alt="Settings" width="40" height="40" />
      </button>
      <div style="flex:1"></div>
      <!-- show logout when user is logged in, otherwise show user icon -->
      <ng-container *ngIf="isLoggedIn; else showUser">
        <button title="Logout" class="icon-btn" [class.active-icon]="activeIcon === 'Logout'" (click)="logout()">
          <span class="active-line" *ngIf="activeIcon === 'Logout'"></span>
          <img src="assets/UI%20Design/logout.svg" alt="Logout" width="40" height="40" />
        </button>
      </ng-container>
      <ng-template #showUser>
        <button title="Account" class="icon-btn" [class.active-icon]="activeIcon === 'Account'" (click)="openAuth('login')">
          <span class="active-line" *ngIf="activeIcon === 'Account'"></span>
          <img src="assets/UI%20Design/user.svg" alt="User" width="40" height="40" />
        </button>
      </ng-template>
    </div>

    <!-- workspace: editor + right panel -->
    <div class="workspace">
      <!-- editor area -->
      <div class="editor-wrap" role="region" aria-label="Editor area">
        <div class="tabbar">
          <ng-container *ngFor="let file of files; let i = index">
            <div class="file-tab" [class.   le]="i === selectedFileIndex">
              {{file.name}}
              <span class="file-ext">.{{file.ext}}</span>
              <button class="close-file-btn" (click)="removeFile(i)">&times;</button>
            </div>
          </ng-container>
          <button class="add-file-btn" (click)="addFile()">+</button>
          <div style="margin-left:auto;color:var(--muted);font-size:13px">Unsaved</div>
        </div>

        <div class="editor">
          <div class="editor-container" #editorContainer aria-label="Code editor"></div>
        </div>
      </div>

      <!-- right column -->
      <div class="rightcol" role="complementary" aria-label="Terminal" [class.minimized-terminal]="minimizedTerminal">
        <div class="panel-header">
          <div class="terminal-title-row">
            <div style="width:8px;height:30px;background:linear-gradient(180deg,var(--accent),#ff5a2d);border-radius:4px"></div>
            <img src="assets/UI Design/Terminal.svg" alt="Terminal" class="terminal-svg" width="32" height="32" (click)="toggleMinimizeTerminal()" [attr.aria-label]="minimizedTerminal ? 'Restore Terminal' : 'Minimize Terminal'" />
            <div class="terminal-title-text">Terminal</div>
          </div>
        </div>

        <div class="console" id="console">
          <div class="line" *ngFor="let ln of consoleLines" [ngClass]="ln.type">{{ln.text}}</div>
        </div>

        <div class="terminal-actions">
          <button class="terminal-btn" (click)="clearConsole()">Clear</button>
          <button class="terminal-btn" (click)="downloadOutput()">Download</button>
        </div>
      </div>
    </div> <!-- workspace -->
  </div> <!-- main -->
</div>

<div class="auth-modal-backdrop" *ngIf="showAuthModal">
  <div class="auth-modal" role="dialog" aria-modal="true" aria-label="Authentication dialog">
    <button class="auth-close" (click)="closeAuth()">&times;</button>

    <div class="auth-left">
      <h2>{{ authMode === 'login' ? 'Welcome back' : 'Create account' }}</h2>
      <p class="muted">Sign in or create an account to save your projects and run trusted code.</p>

      <div class="auth-tabs">
        <button [class.active]="authMode==='login'" (click)="authMode='login'">Login</button>
        <button [class.active]="authMode==='signup'" (click)="authMode='signup'">Sign up</button>
      </div>

      <form *ngIf="authMode==='login'" (ngSubmit)="submitLogin()" class="auth-form">
        <input type="email" placeholder="Email" [(ngModel)]="loginEmail" name="loginEmail" required />
        <input type="password" placeholder="Password" [(ngModel)]="loginPassword" name="loginPassword" required />
        <div class="auth-error" *ngIf="authError">{{authError}}</div>
        <button class="auth-submit" type="button" (click)="submitLogin()">Login</button>
        <button class="auth-alt" type="button" (click)="openAuth('signup')">Create an account</button>
      </form>

      <form *ngIf="authMode==='signup'" (ngSubmit)="submitSignup()" class="auth-form">
        <input type="text" placeholder="Full name" [(ngModel)]="signupName" name="signupName" required [disabled]="isAuthLoading" />
        <input type="email" placeholder="Email" [(ngModel)]="signupEmail" name="signupEmail" required [disabled]="isAuthLoading" />
        <input type="password" placeholder="Password" [(ngModel)]="signupPassword" name="signupPassword" required [disabled]="isAuthLoading" />
        <div class="auth-error" *ngIf="authError">{{authError}}</div>
        <button class="auth-submit" type="button" (click)="submitSignup()" [disabled]="isAuthLoading">{{ isAuthLoading ? 'Creating account...' : 'Sign up' }}</button>
        <button class="auth-alt" type="button" (click)="openAuth('login')" [disabled]="isAuthLoading">Already have an account?</button>
      </form>

      <div class="auth-guest">or <a href="#" (click)="$event.preventDefault(); continueAsGuest()">continue as guest</a></div>
    </div>

    <div class="auth-right">
      <img src="assets/UI%20Design/auth-illustration.svg" alt="Authentication illustration" />
    </div>

  </div>
</div>

<!-- Template-only; interactions handled in Angular component -->